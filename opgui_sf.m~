%Nitin skandan, 11-Aug-2011
% This is the s function which passes data from model to GUI
function [sys,x0,str,ts] = opgui_sf(t,x,u,flag,Ts)
%Control GUI for DRS

%   Nitin Skandan 27-1-2011
switch flag,
  case 0,
    [sys,x0,str,ts]=mdlInitializeSizes(Ts); 
  case 2,
    sys=mdlUpdate(t,x,u,Ts);
  case 3,
    sys = mdlOutputs(t,x,u); % Calculate outputs
  case { 1, 4, 9 },
    sys = [0 0 0 0];
  otherwise
    error(['Unhandled flag = ',num2str(flag)]);
end
% end drs_switch

function [sys,x0,str,ts]=mdlInitializeSizes(Ts)

% call simsizes for a sizes structure, fill it in and convert to a sizes array.
sizes = simsizes;

sizes.NumContStates  = 0;
sizes.NumDiscStates  = 1;
sizes.NumOutputs     = 0;
sizes.NumInputs      = 4;
sizes.DirFeedthrough = 0;
sizes.NumSampleTimes = 1;

sys = simsizes(sizes);
x0  = [0];
str = [];
ts  = [Ts 0];
% create the figure, if necessary
OpGUI;
% end mdlInitializeSizes

function sys=mdlUpdate(t,x,u,Ts)
fig = get_param(gcbh,'UserData'); %get figure handle
sys=x;
'one'
u(1)
'two'
u(2)
u(3)
u(4)
'four'
if ishandle(fig), % 
     fanlight = findobj(fig,'Tag','radiobutton1');
       heaterlight = findobj(fig,'Tag','radiobutton2');
       current = findobj(fig,'Tag','edit6');
       desired = findobj(fig,'Tag','edit7');
       set(current,'String',round(u(3)));
       set(desired,'String',(u(4)));
       heater = findobj(fig,'Tag','edit3');
       fan = findobj(fig,'Tag','editbox');
       set(heater,'String',abs(u(1)));
       set(fan,'String',round(abs(u(2)),0));
       round(abs(u(2)),0)
       
    if u(1)>0.5,
       set(heaterlight,'Value',1);
    else 
        set(heaterlight,'Value',0);
    end
    if u(2)<-0.5
       set(fanlight,'Value',1);
    else
               set(fanlight,'Value',0);
    end
 
end
% end mdlUpdate

function sys = mdlOutputs(t,x,u)

 sys = [];
% end mdlOutputs

